<!DOCTYPE html>
<html lang="en" style="background: url(bg.png) center;background-size: cover;background-attachment: fixed;background-color: #dce3f3;">
<head>
    <link rel="icon" href="logo.jpg" type="image/jpg">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>注册 - Shell在线工具</title>
    <link rel="stylesheet" href="style.css">
</head>
<body style="height:100%;background: none;display: flex;justify-content: center;">
    <div class="box card" style="width: 40%;position: absolute;top:calc(50% - 125px);height: 250px;min-width: 500px;margin: 0;">
        <p class="tit">注册</p>
        <div class="body" style="padding: 0px 20px 20px 20px;">
            <p id="error" style="color:red;margin: 0;opacity: 0;transition: 100ms;">Loading...</p>
            <div style="display: flex;">
                <p style="width: 50px;margin: 0;padding: 5px 0;">密码</p>
                <input id="password" type="password" class="inp" style="flex-grow: 1;" value="">
            </div>
            <loading style="position: absolute;right: 80px;bottom: 10px;opacity: 0;transition: 100ms;" id="loading">
                <svg width="28px" height="28px" viewBox="0 0 16 16"><circle cx="8px" cy="8px" r="7px"></circle><circle cx="8px" cy="8px" r="6px"></circle></svg>
            </loading>
            <a class="btn" style="position: absolute;right: 10px;bottom: 10px;" onclick="$('#error').css('opacity',0);$('#loading').css('opacity',1);setTimeout(() => {check()}, 500);">注册</a>
        </div>
    </div>
    <script>
        function check() {
            let pw = $('#password').val();
            let er = '';
            if (pw.length < 12) {
                er = '密码必须至少有12个字符，否则强度过低';
            } else if (!/[a-zA-Z]/.test(pw)) {
                er = '密码至少有一个字母，否则强度过低';
            } else if (!/[0-9]/.test(pw) || pw.match(/[0-9]/g).length < 3) {
                er = '密码至少有3个数字，否则强度过低';
            } else if (!/[a-z]/.test(pw) || pw.match(/[a-z]/g).length < 3) {
                er = '密码至少有3个小写字母，否则强度过低';
            } else if (!/[A-Z]/.test(pw) || pw.match(/[A-Z]/g).length < 5) {
                er = '密码至少有5个大写字母，否则强度过低';
            } else if (/[^a-zA-Z0-9_\-]/.test(pw)) {
                er = '密码不能有特殊字符 ("_" 和 "-" 除外)，否则不易识别';
            } else if (!/_/.test(pw)) {
                er = '密码至少有一个下划线，否则强度过低';
            } else if (!/\-/.test(pw)) {
                er = '密码至少有一个连字符，否则强度过低';
            } else if (/[a-z]{3}/.test(pw)) {
                er = '密码中不能连续有3个以上的小写字母，否则强度过低';
            } else if (/[A-Z]{3}/.test(pw)) {
                er = '密码中不能连续有3个以上的大写字母，否则强度过低';
            } else if (/((?:0(?=1)|1(?=2)|2(?=3)|3(?=4)|4(?=5)|5(?=6)|6(?=7)|7(?=8)|8(?=9)|9(?=0)){2}\d)/.test(pw)) {
                er = '密码中不能有3个以上连续递增数字，否则强度过低';
            } else if (/((?:1(?=0)|2(?=1)|3(?=2)|4(?=3)|5(?=4)|6(?=5)|7(?=6)|8(?=7)|9(?=8)|0(?=9)){2}\d)/.test(pw)) {
                er = '密码中不能有3个以上连续递减数字，否则强度过低';
            } else if (/[0-9]{4}/.test(pw)) {
                er = '密码中不能连续有4个以上的数字，否则强度过低';
            } else if (/[a-zA-Z]{4}/.test(pw)) {
                er = '密码中不能连续有4个以上的字母，否则强度过低';
            } else if (/^[0-9_a-z]/.test(pw)) {
                er = '密码的开头只能是大写字母，易于记忆';
            } else if (/[0-9_a-z]$/.test(pw)) {
                er = '密码的结尾只能是大写字母，易于记忆';
            } else if (/(.{1,}).*\1/.test(pw)) {
                er = '密码中不能有重复的字符，否则强度过低';
            } else if (/[\-_]{2}/.test(pw)) {
                er = '密码中不能连续有2个以上的特殊字符，否则强度过低';
            } else if (/((?:\-(?=\d)|\d(?=\-))[\d\-])/.test(pw)) {
                er = '密码中数字和连字符不能连在一起，否则可能误认为是减号';
            } else if (/((?:_(?=[A-Z])|[A-Z](?=_))[_A-Z])/.test(pw)) {
                er = '密码中大写字母和下划线不能连在一起，否则不符常理';
            } else if (/[CMOPSUVWXZ]/.test(pw)) {
                er = '密码中不能出现CMOPSUVWXZ这些大小写相似的字母的大写，否则可能误认，统一使用小写';
            } else if (/[019]/.test(pw)) {
                er = '密码中不能出现0,1,6,9这些数字，否则可能与o,i,b,q混淆';
            } else if (/[\-_].{0,4}[\-_]/.test(pw)) {
                er = '密码中特殊字符至少间隔5个字符，否则可能混淆';
            } else if (/[sS][\-_]*[bB]/.test(pw)) {
                er = '密码中不能出现sb';
            } else if (/2[\-_]*[bB]/.test(pw)) {
                er = '密码中不能出现2b';
            } else if (pw.length > 13) {
                er = '密码必须最多有13个字符，否则不易记忆';
            } else if (/qwerty|asdfgh|zxcvbn|12345|54321|13579|97531/i.test(pw)) {
                er = '密码中不能包含常见的键盘模式，否则强度过低';
            } else if (/password|admin|root|user|test|demo|hello|world|login|register/i.test(pw)) {
                er = '密码中不能包含常见的英文单词，否则强度过低';
            } else if (/[a-z]{4,}|[A-Z]{4,}|[0-9]{4,}/.test(pw)) {
                er = '密码中不能连续有3个以上的相同类型字符，否则强度过低';
            } else if (/19\d{2}|20\d{2}|\d{4}/.test(pw)) {
                er = '密码中不能包含日期格式，否则强度过低';
            } else if (/abc|bcd|cde|def|efg|fgh|ghi|hij|ijk|jkl|klm|lmn|mno|nop|opq|pqr|qrs|rst|stu|tuv|uvw|vwx|wxy|xyz|zyx|yxw|xwv|wvu|vut|uts|tsr|srq|rqp|qpo|pon|onm|nml|mlk|lkj|kji|jih|ihg|hgf|gfe|fed|edc|dcb|cba/i.test(pw)) {
                er = '密码中不能包含连续的字母序列，否则强度过低';
            } else if (/fuck|shit|damn|bitch|ass|porn|sex|drug|hacker|hack|virus|malware|trojan/i.test(pw)) {
                er = '密码中不能出现特定敏感词汇，否则强度过低';
            }

            if (er) {
                $('#error').text(er);
                $('#error').css('opacity', 1);
                $('#loading').css('opacity', 0);
            } else {
                // 调用API进行注册
                let tel = sessionStorage.getItem('user_tel') || '10000000000';
                
                fetch('http://localhost:8000/api.php?action=register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        telephone: tel,
                        password: pw
                    })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        $('#error').text('注册成功，正在跳转到登录界面');
                        $('#error').css('opacity', 1);
                        try { 
                            sessionStorage.setItem('user_pw', pw); 
                            sessionStorage.setItem('user_info', JSON.stringify(data.user));
                        } catch (e) {}
                        setTimeout(function(){ window.location = 'login.html'; }, 600);
                    } else {
                        $('#error').text('注册失败: ' + (data.error || '未知错误'));
                        $('#error').css('opacity', 1);
                        $('#loading').css('opacity', 0);
                    }
                })
                .catch(error => {
                    let errorMsg = '网络错误，请稍后重试';
                    if (error.response) {
                        // 服务器返回了错误状态码
                        errorMsg = `请求失败：${error.response.status} - ${error.response.statusText}`;
                    } else if (error.request) {
                        // 请求已发送但没有收到响应
                        errorMsg = '网络错误：服务器未响应，请检查网络连接或服务器状态';
                    } else {
                        // 请求设置时发生错误
                        errorMsg = `请求错误：${error.message}`;
                    }
                    $('#error').text(errorMsg);
                    $('#error').css('opacity', 1);
                    $('#loading').css('opacity', 0);
                });
            }
        }
        
        // 标答 Ka_3Ab2Gc5D-E
    </script>
    <script src="jq.min.js"></script>
    <script src="scroll.js"></script>
    <script src="tracker.js"></script>
</body>
</html>
